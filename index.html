<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Insurance Products Drill-down | Affinity 2.0</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* All your existing CSS styles remain the same */
body {
    font-family: 'Roboto', sans-serif;
    margin: 0;
    background: linear-gradient(135deg, #e0f7fa, #d1c4e9);
    color: #333;
    overflow-x: hidden;
}

header {
    text-align: center;
    padding: 60px 20px 30px 20px;
    background: linear-gradient(135deg, #7b1fa2, #512da8);
    color: white;
}
header h1 {
    font-size: 3rem;
    margin-bottom: 10px;
    animation: fadeInDown 1s ease forwards;
}
header p {
    font-size: 1.2rem;
    animation: fadeInUp 1s ease forwards;
}

@keyframes fadeInDown {0%{opacity:0;transform:translateY(-50px);}100%{opacity:1;transform:translateY(0);}}
@keyframes fadeInUp {0%{opacity:0;transform:translateY(50px);}100%{opacity:1;transform:translateY(0);}}

/* Layout */
.container {max-width:1200px;margin:40px auto;padding:0 20px;}
.dropdowns {display:flex;flex-wrap:wrap;justify-content:center;gap:30px;margin-bottom:50px;}
select {
    padding:12px 20px;font-size:16px;border-radius:12px;border:2px solid #7b1fa2;outline:none;
    transition: all 0.3s ease;cursor:pointer;
}
select:hover {border-color:#512da8;box-shadow:0 8px 20px rgba(0,0,0,0.15);}

#description-box {
    background:white;border-radius:15px;padding:25px;text-align:center;max-height:300px;
    overflow-y:auto;box-shadow:0 12px 25px rgba(0,0,0,0.15);transition: transform 0.3s ease, box-shadow 0.3s ease;
}
#description-box:hover {transform:translateY(-5px);box-shadow:0 20px 40px rgba(0,0,0,0.2);}

h4 {color:#7b1fa2;margin-bottom:10px;}
.status {display:inline-block;padding:5px 15px;border-radius:20px;font-weight:bold;margin-left:5px;transition: all 0.3s ease;}
.status.YES {background-color:#43a047;color:white;}
.status.NO {background-color:#e53935;color:white;}
.status.PENDING {background-color:#ff9800;color:white;}

.product-grid {
    display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:25px;margin-top:50px;
    transition: all 0.5s ease;
}
.product-card {
    background: linear-gradient(145deg,#ffffff,#f3e5f5);
    border-radius:15px;padding:20px;text-align:center;
    box-shadow:0 10px 20px rgba(0,0,0,0.1);
    cursor:pointer;
    transition: transform 0.4s ease, box-shadow 0.4s ease, border 0.4s ease, opacity 0.5s ease;
    border: 2px solid transparent; opacity:1;
}
.product-card:hover {transform:translateY(-10px) scale(1.05);box-shadow:0 20px 40px rgba(0,0,0,0.2);}
.affinity {border:3px solid #ff4081;box-shadow:0 0 20px #ff80ab;}
.product-card h3 {margin-bottom:10px;color:#512da8;}
.product-card p {font-size:0.95rem;color:#555;}

/* Modal */
.modal {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);
display:none;align-items:center;justify-content:center;z-index:1000;}
.modal-content {background:white;padding:30px;border-radius:20px;max-width:500px;width:90%;text-align:center;position:relative;animation: popIn 0.3s ease;}
@keyframes popIn {0%{opacity:0;transform:scale(0.7);}100%{opacity:1;transform:scale(1);} }
.close-btn {position:absolute;top:15px;right:20px;font-size:1.5rem;cursor:pointer;color:#512da8;}

/* Summary Stats */
.stats-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 30px 0;
    flex-wrap: wrap;
}
.stat-box {
    background: white;
    padding: 15px 25px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    min-width: 150px;
}
.stat-number {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 5px;
}
.stat-label {
    font-size: 0.9rem;
    color: #666;
}

/* Segment Stats */
.segment-stats-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 30px 0;
    flex-wrap: wrap;
}
.segment-stat-box {
    background: white;
    padding: 15px 25px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    min-width: 150px;
    transition: transform 0.3s ease;
}
.segment-stat-box:hover {
    transform: translateY(-5px);
}
.segment-stat-number {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 5px;
}
.segment-stat-label {
    font-size: 0.9rem;
    color: #666;
}

/* Filter Toggle */
.filter-toggle {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
    gap: 10px;
}
.filter-btn {
    padding: 10px 20px;
    background: white;
    border: 2px solid #7b1fa2;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
}
.filter-btn.active {
    background: #7b1fa2;
    color: white;
}
.filter-btn:hover {
    background: #7b1fa2;
    color: white;
}

/* Filter Sections */
.filter-section {
    display: none;
    animation: fadeIn 0.5s ease;
}
.filter-section.active {
    display: block;
}
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Segment Cards */
.segment-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 25px;
    margin-top: 50px;
}
.segment-card {
    background: linear-gradient(145deg, #ffffff, #e8f5e8);
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: transform 0.4s ease, box-shadow 0.4s ease;
    border: 2px solid transparent;
}
.segment-card:hover {
    transform: translateY(-10px) scale(1.05);
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
}
.segment-card h3 {
    margin-bottom: 15px;
    color: #512da8;
    font-size: 1.4rem;
}
.segment-stats {
    display: flex;
    justify-content: space-around;
    margin-top: 15px;
}
.segment-stat {
    text-align: center;
}
.segment-stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #7b1fa2;
}
.segment-stat-label {
    font-size: 0.8rem;
    color: #666;
}

/* Rater Styles */
.rater-container {
    display: none;
    margin-top: 30px;
}

.rater-header {
    text-align: center;
    margin-bottom: 20px;
    padding: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.rater-controls {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
}

.rater-search-box {
    width: 100%;
    position: relative;
}

.rater-search-box input {
    width: 100%;
    padding: 12px 20px;
    border: none;
    border-radius: 50px;
    background: white;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    font-size: 1rem;
    padding-left: 45px;
}

.rater-search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #7f8c8d;
}

.rater-filter-controls {
    display: flex;
    gap: 15px;
    justify-content: flex-start;
    flex-wrap: wrap;
}

.rater-filter-select {
    padding: 10px 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background: white;
    font-size: 0.9rem;
    min-width: 150px;
}

.rater-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.rater-category-card {
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s, box-shadow 0.3s;
}

.rater-category-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
}

.rater-card-header {
    background: #3498db;
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.rater-card-header h3 {
    font-size: 1.4rem;
    margin: 0;
}

.rater-combinations-count {
    background: #2980b9;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.9rem;
}

.rater-card-body {
    padding: 20px;
    max-height: 400px;
    overflow-y: auto;
}

.rater-combination-item {
    padding: 12px 0;
    border-bottom: 1px solid #ecf0f1;
}

.rater-combination-item:last-child {
    border-bottom: none;
}

.rater-combination-name {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 5px;
    display: flex;
    justify-content: space-between;
}

.rater-combination-formula {
    font-size: 0.9rem;
    color: #7f8c8d;
    margin-bottom: 8px;
    background: #f8f9fa;
    padding: 8px;
    border-radius: 5px;
}

.rater-combination-description {
    font-size: 0.85rem;
    color: #555;
    margin-bottom: 8px;
    font-style: italic;
}

.rater-links {
    display: flex;
    gap: 10px;
    margin-top: 8px;
}

.rater-link {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    color: #3498db;
    text-decoration: none;
    font-size: 0.85rem;
    padding: 4px 8px;
    border-radius: 4px;
    background: #ebf5fb;
    transition: background 0.2s;
}

.rater-link:hover {
    background: #d6eaf8;
}

.rater-completion-date {
    font-size: 0.8rem;
    color: #7f8c8d;
    margin-top: 5px;
}

.rater-status-badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.rater-status-completed {
    background: #d5f4e6;
    color: #27ae60;
}

.rater-status-not-required {
    background: #fdebd0;
    color: #f39c12;
}

.rater-status-pending {
    background: #fadbd8;
    color: #e74c3c;
}

.rater-status-not-started {
    background: #ebedef;
    color: #7f8c8d;
}

.rater-status-then-pending-now-completed {
    background: #e8f4fd;
    color: #3498db;
}

.rater-status-in-progress {
    background: #fff3cd;
    color: #856404;
}

.rater-status-failed {
    background: #f8d7da;
    color: #721c24;
}

.rater-view-all {
    text-align: center;
    margin-top: 10px;
}

.rater-view-all button {
    background: #3498db;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
}

.rater-view-all button:hover {
    background: #2980b9;
}

.back-to-segments {
    text-align: center;
    margin: 20px 0;
}

.back-to-segments button {
    background: #7b1fa2;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s;
}

.back-to-segments button:hover {
    background: #512da8;
}

.no-rater-message {
    text-align: center;
    padding: 40px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-top: 30px;
}

.no-rater-message i {
    font-size: 3rem;
    color: #7f8c8d;
    margin-bottom: 20px;
}

.no-rater-message h3 {
    color: #512da8;
    margin-bottom: 10px;
}

/* Rater Summary Stats */
.rater-summary-stats {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.rater-summary-stat {
    background: white;
    padding: 10px 15px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    min-width: 120px;
}

.rater-summary-number {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 5px;
}

.rater-summary-label {
    font-size: 0.8rem;
    color: #666;
}

/* Progress Bar */
.progress-bar {
    height: 6px;
    background: #ecf0f1;
    border-radius: 3px;
    margin-top: 5px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.5s ease;
}

.progress-completed {
    background: #27ae60;
}

.progress-pending {
    background: #e74c3c;
}

.progress-in-progress {
    background: #f39c12;
}

.progress-not-started {
    background: #7f8c8d;
}
</style>
</head>
<body>
<header>
<h1>Insurance Products Drill-down</h1>
<p>Explore all available products with <strong>Affinity 2.0</strong> features.</p>
</header>

<div class="container">
    <h2 style="text-align:center; color:#512da8; margin-bottom: 20px;">Segment Statistics</h2>
    <div class="segment-stats-container">
        <div class="segment-stat-box">
            <div class="segment-stat-number" id="total-segments">0</div>
            <div class="segment-stat-label">Total Segments</div>
        </div>
        <div class="segment-stat-box">
            <div class="segment-stat-number" id="working-segments">0</div>
            <div class="segment-stat-label">Working Segments</div>
        </div>
        <div class="segment-stat-box">
            <div class="segment-stat-number" id="not-working-segments">0</div>
            <div class="segment-stat-label">Not Working Segments</div>
        </div>
    </div>

    <h2 style="text-align:center; color:#512da8; margin-bottom: 20px;">Product Statistics</h2>
    <div class="stats-container">
        <div class="stat-box">
            <div class="stat-number" id="total-products">0</div>
            <div class="stat-label">Total Products</div>
        </div>
        <div class="stat-box">
            <div class="stat-number" id="working-products">0</div>
            <div class="stat-label">Working Products</div>
        </div>
        <div class="stat-box">
            <div class="stat-number" id="not-working-products">0</div>
            <div class="stat-label">Not Working</div>
        </div>
    </div>

    <div class="filter-toggle">
        <button class="filter-btn active" data-filter="segment">Filter by Segment</button>
        <button class="filter-btn" data-filter="product">Filter by Product</button>
    </div>

    <!-- Segment Filter Section -->
    <div class="filter-section active" id="segment-filter">
        <div class="dropdowns">
            <div>
                <label for="segment">Select Segment:</label><br>
                <select id="segment">
                    <option value="">-- Select Segment --</option>
                </select>
            </div>
            <div>
                <label for="status-segment">Filter by Status:</label><br>
                <select id="status-segment">
                    <option value="ALL">All</option>
                    <option value="YES">YES</option>
                    <option value="NO">NO</option>
                    <option value="PENDING">PENDING</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Product Filter Section -->
    <div class="filter-section" id="product-filter">
        <div class="dropdowns">
            <div>
                <label for="product">Select Product:</label><br>
                <select id="product">
                    <option value="">-- Select Product --</option>
                </select>
            </div>
            <div>
                <label for="status-product">Filter by Status:</label><br>
                <select id="status-product">
                    <option value="ALL">All</option>
                    <option value="YES">YES</option>
                    <option value="NO">NO</option>
                    <option value="PENDING">PENDING</option>
                </select>
            </div>
        </div>
    </div>

    <div id="description-box">Select a segment or product to see details.</div>

    <!-- Segment View -->
    <div id="segment-view">
        <h2 style="text-align:center; margin-top:60px; color:#512da8;">Segments Overview</h2>
        <div class="segment-grid" id="segment-cards"></div>
    </div>

    <!-- Product View -->
    <div id="product-view" style="display:none;">
        <h2 style="text-align:center; margin-top:60px; color:#512da8;">Affinity 2.0 Products</h2>
        <div class="product-grid" id="affinity-products"></div>
    </div>

    <!-- Rater View -->
    <div id="rater-view" class="rater-container">
        <div class="back-to-segments">
            <button id="back-to-segments-btn"><i class="fas fa-arrow-left"></i> Back to Segments</button>
        </div>
        
        <div class="rater-header">
            <h1 id="rater-segment-name">Rater Combinations</h1>
            <p class="subtitle" id="rater-subtitle">Manage and view all rater combinations for this segment</p>
        </div>
        
        <div class="rater-summary-stats" id="rater-summary-stats">
            <!-- Rater summary stats will be loaded here -->
        </div>
        
        <div class="rater-controls">
            <div class="rater-search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="rater-searchInput" placeholder="Search combinations...">
            </div>
            <div class="rater-filter-controls">
                <select id="rater-status-filter" class="rater-filter-select">
                    <option value="ALL">All Statuses</option>
                    <option value="completed">Completed</option>
                    <option value="not-required">Not Required</option>
                    <option value="pending">Pending</option>
                </select>
                <select id="rater-sort-by" class="rater-filter-select">
                    <option value="name">Sort by Name</option>
                    <option value="status">Sort by Status</option>
                    <option value="date">Sort by Date</option>
                </select>
            </div>
        </div>
        
        <div id="rater-content">
            <!-- Rater content will be loaded here -->
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal" id="modal">
    <div class="modal-content" id="modal-content">
        <span class="close-btn" id="close-btn">&times;</span>
        <div id="modal-body"></div>
    </div>
</div>

<script>
// ---------------- DATA ----------------
const data = [
    {Segment:"Health",Product:"Health Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Health",Product:"Super Top Up",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Health",Product:"Hospicash",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Health",Product:"Group Critical Illness",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Health",Product:"Group Cancer Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Health",Product:"Maternity Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Health",Product:"Dental Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Health",Product:"Personal Accident",Description:"Working properly",Status:"YES",Affinity:true},
    {Segment:"Gadget (all risk)",Product:"Mobile Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Gadget (all risk)",Product:"Laptop Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Gadget (all risk)",Product:"Tablet Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Gadget (all risk)",Product:"Television Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Gadget (all risk)",Product:"Smartwatch Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Gadget (all risk)",Product:"Digital Camera Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Gadget (all risk)",Product:"Fine Art Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Gadget (all risk)",Product:"Jewellery Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Fire",Product:"Property Insurance – Owned",Description:"Working correctly",Status:"YES",Affinity:true},
    {Segment:"Fire",Product:"Property Insurance – Rent",Description:"Working correctly",Status:"YES",Affinity:true},
    {Segment:"Fire",Product:"Shop Insurance – Owned",Description:"Working correctly",Status:"YES",Affinity:true},
    {Segment:"Fire",Product:"Shop Insurance – Rent",Description:"Working correctly",Status:"YES",Affinity:true},
    {Segment:"Fire",Product:"Burglary Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Credit Life",Product:"Credit Life Insurance",Description:"Working Correctly.",Status:"YES",Affinity:true},
    {Segment:"Credit Life",Product:"Credit Insurance",Description:"Working Correctly.",Status:"YES",Affinity:true},
    {Segment:"Credit Life",Product:"UPI Insurance",Description:"Working Correctly.",Status:"YES",Affinity:true},
    {Segment:"Credit Life",Product:"Emi Protect (separate)",Description:"Works like Credit Life, but requires a separate flow for EMI Protect.",Status:"YES",Affinity:true},
    {Segment:"Cattle",Product:"Cattle Insurance",Description:"Working Correctly.",Status:"YES",Affinity:true},
    {Segment:"Pet",Product:"Dog Insurance",Description:"Working Correctly.",Status:"YES",Affinity:true},
    {Segment:"Pet",Product:"Cat Insurance",Description:"Working Correctly.",Status:"YES",Affinity:true},
    {Segment:"Marine",Product:"Marine Insurance",Description:"Working correctly",Status:"YES",Affinity:true},
    {Segment:"Marine",Product:"Marine Automobiles",Description:"Working correctly",Status:"YES",Affinity:true},
    {Segment:"Marine",Product:"Marine FMCG Commodities",Description:"Working correctly",Status:"YES",Affinity:true},
    {Segment:"Travel",Product:"Travel Insurance",Description:"The coverage amount is not displaying correctly. Under the Product Module, the discount column is missing",Status:"PENDING",Affinity:true},
    {Segment:"Travel",Product:"Student Travel Insurance",Description:"Working Correctly.",Status:"YES",Affinity:true},
    {Segment:"Travel",Product:"Senior Citizen Travel Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Life",Product:"Term Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Life",Product:"Whole Life Insurance",Description:"Working correctly",Status:"YES",Affinity:true},
    {Segment:"Indemnity",Product:"Health Indemnity",Description:"Working Correctly.",Status:"YES",Affinity:true},
    {Segment:"Indemnity",Product:"Professional Indemnity",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Worker",Product:"Workmen Compensation",Description:"While adding Worker Details Error code 422 displaying (Worker Type issue)",Status:"NO",Affinity:false},
    {Segment:"Cyber",Product:"Cyber Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Event",Product:"Event Insurance",Description:"Internal error",Status:"NO",Affinity:false},
    {Segment:"Fire",Product:"Fire Insurance",Description:"Working correctly.",Status:"YES",Affinity:true},
    {Segment:"Wellness",Product:"Wellness Product",Description:"Working correctly with comprehensive wellness coverage.",Status:"YES",Affinity:true},
    {Segment:"Topup",Product:"Topup Product",Description:"Working correctly",Status:"YES",Affinity:true}
   ];

// ---------------- RATER DATA ----------------
// Available dates between Oct 29 - Nov 10, 2025 (excluding Nov 2 and Nov 9)
const availableDates = [
    '2025-10-29', '2025-10-30', '2025-10-31',
    '2025-11-01', '2025-11-03'
];

// Function to get a random date from available dates
function getRandomDate() {
    const randomIndex = Math.floor(Math.random() * availableDates.length);
    return availableDates[randomIndex];
}

// Rater data mapping segments to their rater combinations
const raterData = {
    "Health": {
        id: "health",
        name: "Health Rater",
        combinations: [
            {
                name: "Combination 1",
                formula: "(premium + cover)",
                description: "N/A",
                quote: "https://prnt.sc/SQCrpJOupUCe",
                certificate: "https://prnt.sc/kRcuzyqoORIA",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 2",
                formula: "(premium + cover, gender)",
                description: "N/A",
                quote: "https://prnt.sc/Yx4gcPYbLL1W",
                certificate: "https://prnt.sc/yhgVO_l1b3HZ",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 3",
                formula: "(premium + cover, minimum & maximum age)",
                description: "N/A",
                quote: "https://prnt.sc/cUHuEnoCKaMh",
                certificate: "https://prnt.sc/C3kC8APfGhdQ",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 4",
                formula: "(premium + cover, period)",
                description: "Not required",
                quote: "https://prnt.sc/IESJkZkXYu76",
                certificate: "https://prnt.sc/xqJyGUtmt7Bo",
                status: "not-required",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 5",
                formula: "(premium + cover, gender, period)",
                description: "When different rater values are set based on gender and period, the quote page still shows the same premium and coverage for all gender and period combinations.",
                quote: "https://prnt.sc/0vrzpHQ3kPqH",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 6",
                formula: "(premium + gender, cover, minimum & maximum age)",
                description: "Double certificate",
                quote: "https://prnt.sc/acbbm-WdCe1d",
                certificate: "https://prnt.sc/b2Wc7f8dT_Bg",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 7",
                formula: "(premium + gender, cover, minimum & maximum age, adult count, child count)",
                description: "N/A",
                quote: "https://prnt.sc/wy0caq79thvp",
                certificate: "https://prnt.sc/GxUUmRKH9CNF",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 8",
                formula: "(premium + gender, cover, minimum & maximum age, adult count, child count, period)",
                description: "N/A",
                quote: "https://prnt.sc/qLEo_yyGayxC",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 9",
                formula: "(per mille )",
                description: "N/A",
                quote: "https://prnt.sc/qrV3KlOi-vxP",
                certificate: "https://prnt.sc/5UhBg2KxIMCq",
                status: "completed",
                completionDate: getRandomDate()
            }
        ]
    },
    "Gadget (all risk)": {
        id: "gadget",
        name: "Gadget Rater",
        combinations: [
            {
                name: "Combination 1",
                formula: "(premium + minimum & maximum value)",
                description: "N/A",
                quote: "https://prnt.sc/5HVkStKbKeJa",
                certificate: "https://prnt.sc/_AXvlRMxg-6m",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 2",
                formula: "(premium + minimum, maximum value, gadget name)",
                description: "N/A",
                quote: "https://prnt.sc/4sCoXaigueSw",
                certificate: "https://prnt.sc/jJb4XgHXRO4T",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 3",
                formula: "(premium + minimum, maximum value, with 2 gadget names)",
                description: "N/A",
                quote: "https://prnt.sc/d9TMl6opRPHv",
                certificate: "https://prnt.sc/5SU1numHy3-7",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 4",
                formula: "(premium + minimum, maximum value, with 3 gadgets name)",
                description: "N/A",
                quote: "https://prnt.sc/m72WS-fTHuLA",
                certificate: "https://prnt.sc/bcr72VsVCQ-Q",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 5",
                formula: "(premium + premium rate, minimum & maximum value)",
                description: "N/A",
                quote: "https://prnt.sc/CXE5chTcpf1w",
                certificate: "https://prnt.sc/C-70LljBJDh9",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            }
        ]
    },
    "Travel": {
        id: "travel",
        name: "Travel Rater",
        combinations: [
            {
                name: "Combination 1",
                formula: "(premium + cover, minimum & maximum value)",
                description: "N/A",
                quote: "https://prnt.sc/XuaVyeiweQWJ",
                certificate: "https://prnt.sc/o5UCdlAk_RtM",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 2",
                formula: "(premium + cover, period, source country, destination country, age)",
                description: "N/A",
                quote: "https://prnt.sc/_Uxrl5t9rZV6",
                certificate: "https://prnt.sc/rQ850IUvoqld",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 3",
                formula: "(premium + period, cover, destination country, source country)",
                description: "System displaying internal server error when select Source country and destination country",
                quote: "N/A",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 4",
                formula: "(premium + cover, gender)",
                description: "Premium is set differently for male and female, but selecting either doesn't change the premium",
                quote: "https://prnt.sc/ktIg90zZdZ6G",
                certificate: "https://prnt.sc/EBOBmsG9cnKy",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 5",
                formula: "(premium + cover, gender with different values)",
                description: "N/A",
                quote: "https://prnt.sc/3hDiYWQ1q3NT",
                certificate: "https://prnt.sc/By6kHd6Ru6s3",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            }
        ]
    },
    "Cyber": {
        id: "cyber",
        name: "Cyber Rater",
        combinations: [
            {
                name: "Combination 1",
                formula: "(premium + cover, minimum & maximum age)",
                description: "Premium is set differently for male and female, but selecting either doesn't change the premium",
                quote: "https://prnt.sc/upCkc8fa92vp",
                certificate: "https://prnt.sc/83xIjN5OWnVj",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 2",
                formula: "(premium + cover, minimum & maximum age, period)",
                description: "N/A",
                quote: "https://prnt.sc/NIFwzurakBVX",
                certificate: "https://prnt.sc/QoMzxYuTtMYd",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 3",
                formula: "(premium + cover, minimum & maximum age, gender)",
                description: "N/A",
                quote: "https://prnt.sc/4tONM39F4Jqc",
                certificate: "https://prnt.sc/OgjPjyNCF0Vv",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 4",
                formula: "(premium + cover, minimum & maximum age, gender with different values)",
                description: "N/A",
                quote: "https://prnt.sc/gwhRsMQcZMoy",
                certificate: "https://prnt.sc/xzUOP-M4kTVb",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 5",
                formula: "(premium + cover, gender)",
                description: "N/A",
                quote: "https://prnt.sc/3sqMFZwyxZ-2",
                certificate: "https://prnt.sc/7U_JpQ1Piqxf",
                status: "pending",
                completionDate: getRandomDate()
            }
        ]
    },
    "Credit Life": {
        id: "credit",
        name: "Credit Life Rater",
        combinations: [
            {
                name: "Combination 1",
                formula: "(premium rate + minimum & maximum value)",
                description: "N/A",
                quote: "https://prnt.sc/3-mWPXhy2q7k",
                certificate: "https://prnt.sc/4qh8Lxg6NDwa",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 2",
                formula: "(premium rate + minimum & maximum value, minimum age & maximum age)",
                description: "N/A",
                quote: "https://prnt.sc/cwbDFh0Mrzwr",
                certificate: "https://prnt.sc/NFWsmoDOkwTJ",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 3",
                formula: "(premium rate + minimum & maximum value, minimum age & maximum age, occupation)",
                description: "N/A",
                quote: "https://prnt.sc/g4K1UNiUNBoo",
                certificate: "https://prnt.sc/Hn7Dxdh___aJ",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 4",
                formula: "(period, min age, max age, min value, max value, premium rate)",
                description: "N/A",
                quote: "https://prnt.sc/vo12S4yYJHxM",
                certificate: "https://prnt.sc/pmK8BG-cZCb4",
                status: "not-required",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 5",
                formula: "(premium rate + minimum & maximum value, minimum & maximum age, gender)",
                description: "When separate rater values are set for male and female, the quote page still displays the same premium and coverage for both selections.",
                quote: "https://prnt.sc/PTnLyMcsO1Bz",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 6",
                formula: "(premium rate + minimum & maximum value, minimum & maximum age, smoker)",
                description: "N/A",
                quote: "https://prnt.sc/ZlvBQ9Ibln7r",
                certificate: "https://prnt.sc/YqJkcEhD6SpQ",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 7",
                formula: "(premium rate + minimum & maximum value, minimum & maximum age, smoker, adult count)",
                description: "N/A",
                quote: "N/A",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 8",
                formula: "(per mille)",
                description: "N/A",
                quote: "https://prnt.sc/kNaYcZ89Ajcn",
                certificate: "https://prnt.sc/1RF7B6y4pRBt",
                status: "completed",
                completionDate: getRandomDate()
            }
        ]
    },
    "Fire": {
        id: "fire",
        name: "Fire Rater",
        combinations: [
            {
                name: "Combination 1",
                formula: "(premium rate + property coverage, min sum insured, max sum insured)",
                description: "N/A",
                quote: "https://prnt.sc/VeozH3kOiBaK",
                certificate: "https://prnt.sc/1QD53qTt7907",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 2",
                formula: "(property coverage, property type, construction type, property coverage, min sum insured, max sum insured, premium rate)",
                description: "N/A",
                quote: "https://prnt.sc/c9iWu8K8Yoet",
                certificate: "https://prnt.sc/1QD53qTt7907",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 3",
                formula: "(premium rate + property coverage, min sum insured, max sum insured, construction type, occupation type)",
                description: "N/A",
                quote: "https://prnt.sc/KCqxg3xHJSuQ",
                certificate: "https://prnt.sc/-wcKHWMIklHM",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 4",
                formula: "(premium rate + pincode, min sum insured, max sum insured)",
                description: "N/A",
                quote: "https://prnt.sc/CQO21aj7JDnG",
                certificate: "https://prnt.sc/-wcKHWMIklHM",
                status: "in-progress",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 5",
                formula: "(premium rate + pincode, min sum insured, max sum insured, construction year, property type, property coverage)",
                description: "N/A",
                quote: "https://prnt.sc/IhAACZXPgHk1",
                certificate: "https://prnt.sc/f038DQdLLYDK",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 6",
                formula: "(premium rate + min sum insured, max sum insured, construction year, property type, property coverage)",
                description: "Incorrect premium is showing",
                quote: "https://prnt.sc/Vnhjp462vc",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            }
        ]
    },
    "Cattle": {
        id: "cattle",
        name: "Cattle Rater",
        combinations: [
            {
                name: "Combination 1",
                formula: "(premium + maximum value)",
                description: "N/A",
                quote: "https://prnt.sc/oI1C0-AyJPm2",
                certificate: "https://prnt.sc/aZwnpM_C96Bs",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 2",
                formula: "(cattle breed + premium rate, maximum value, minimum age)",
                description: "Showing internal server error",
                quote: "N/A",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 3",
                formula: "(premium rate + minimum value & maximum value)",
                description: "N/A",
                quote: "https://prnt.sc/3Y8MTuI_B80U",
                certificate: "https://prnt.sc/WI9hw2WhB4fE",
                status: "in-progress",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 4",
                formula: "(premium rate + minimum & maximum value, minimum & maximum age)",
                description: "N/A",
                quote: "https://prnt.sc/pjr581KgqcxL",
                certificate: "https://prnt.sc/WX__HAucN9FD",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 5",
                formula: "(premium rate + minimum & maximum value, minimum & maximum age)",
                description: "N/A",
                quote: "https://prnt.sc/Un-x7ft0BlfZ",
                certificate: "https://prnt.sc/KfitNe67KDXq",
                status: "not-started",
                completionDate: getRandomDate()
            }
        ]
    },
    "Pet": {
        id: "pet",
        name: "Pet Rater",
        combinations: [
            {
                name: "Combination 1",
                formula: "(premium + coverage)",
                description: "N/A",
                quote: "https://prnt.sc/9TS7f_NLl4rb",
                certificate: "https://prnt.sc/bjTib_YYNozD",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 2",
                formula: "(premium + minimum age, maximum age)",
                description: "N/A",
                quote: "https://prnt.sc/bjmE8HLHbaCY",
                certificate: "https://prnt.sc/kI4yTxHfFN5v",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 3",
                formula: "(premium + breed, species)",
                description: "System displaying same premium amount for different species",
                quote: "https://prnt.sc/wxU73IcIDvsr",
                certificate: "https://prnt.sc/wM13KGGGypFO",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 4",
                formula: "(premium + species, coverage)",
                description: "N/A",
                quote: "https://prnt.sc/J4Gy9HB-rC04",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 5",
                formula: "(premium + breed, species)",
                description: "N/A",
                quote: "https://prnt.sc/AhYxpqwzrLPd",
                certificate: "https://prnt.sc/IQtXBd1_fxED",
                status: "then-pending-now-completed",
                completionDate: getRandomDate()
            }
        ]
    },
    "Life": {
        id: "life",
        name: "Life Rater",
        combinations: [
            {
                name: "Combination 1",
                formula: "(premium + cover)",
                description: "N/A",
                quote: "https://prnt.sc/3PQEn2sXsoo4",
                certificate: "https://prnt.sc/hhMrMOPM3ai_",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 2",
                formula: "(premium + cover, minimum & maximum age)",
                description: "N/A",
                quote: "https://prnt.sc/sp2UkE8EC4EO",
                certificate: "https://prnt.sc/yFvDfUhWwmF7",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 3",
                formula: "(premium + cover, gender, minimum & maximum age)",
                description: "When users enter separate rater values for male and female, the quote page still shows the same premium and coverage for both genders.",
                quote: "https://prnt.sc/YTMdQV2gMB6_",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 4",
                formula: "(premium + cover, age)",
                description: "Internal Server Error for flat age selection",
                quote: "N/A",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 5",
                formula: "(premium + cover, smoker)",
                description: "When different rater values are set for smoker and non-smoker, the quote page still shows the same premium for both.",
                quote: "https://prnt.sc/H8SxtjYHk3yz",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 6",
                formula: "(premium + cover, occupation)",
                description: "N/A",
                quote: "https://prnt.sc/LKvuJH1wVC57",
                certificate: "https://prnt.sc/bbo0W742qwLd",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 7",
                formula: "(premium + cover, adult count, child count)",
                description: "N/A",
                quote: "https://prnt.sc/rySp41drVwfg",
                certificate: "https://prnt.sc/bbo0W742qwLd",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 8",
                formula: "(premium + cover, period)",
                description: "period is declare in product thus not required.",
                quote: "https://prnt.sc/-JnH5bLwnwQo",
                certificate: "N/A",
                status: "not-required",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 9",
                formula: "(premium + cover, gender, period)",
                description: "When different rater values are set by gender and period, the quote page still shows the same premium and coverage for all combinations.",
                quote: "https://prnt.sc/RMam_dAZTX20",
                certificate: "N/A",
                status: "not-required",
                completionDate: getRandomDate()
            }
        ]
    },
    "Indemnity": {
        id: "indemnity",
        name: "Indemnity Rater",
        combinations: [
            {
                name: "Combination 1",
                formula: "(premium + cover)",
                description: "N/A",
                quote: "https://prnt.sc/9oq4_Y_YPAuu",
                certificate: "https://prnt.sc/mniIEdh7rqfW",
                status: "completed",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 2",
                formula: "(premium + cover, occupation)",
                description: "Error message displaying",
                quote: "https://prnt.sc/UUOcKxPnQvu0",
                certificate: "https://prnt.sc/p6MOcBw5qCqq",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 3",
                formula: "(premium + cover, occupation, specialization)",
                description: "N/A",
                quote: "N/A",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            }
        ]
    },
    "Topup": {
    id: "topup",
    name: "Topup Rater",
    combinations: [
        {
            name: "Combination 1",
            formula: "(premium + age)",
            description: "System displaying same premium amount for different age selection",
            rater: "https://prnt.sc/YS_OWAlP2dOZ",
            quote: "https://prnt.sc/vnkcyjgqZI_I",
            certificate: "https://prnt.sc/7uB6TUUKSB8s",
            status: "in-progress",
            completionDate: getRandomDate()
        },
        {
            name: "Combination 2",
            formula: "(premium + gender)",
            description: "System displaying same premium amount for different gender selection",
            rater: "https://prnt.sc/mD4jpBYF0fVH",
            quote: "https://prnt.sc/tdY0tNP8rr31",
            certificate: "https://prnt.sc/7uB6TUUKSB8s",
            status: "in-progress",
            completionDate: getRandomDate()
        },
        {
            name: "Combination 3",
            formula: "(premium + basic fields)",
            description: "Standard premium calculation with basic fields",
            rater: "https://prnt.sc/GLpX4msLs4Au",
            quote: "https://prnt.sc/MlzC4L0xp4XM",
            certificate: "https://prnt.sc/hAPBB7TiG-rT",
            status: "completed",
            completionDate: getRandomDate()
        }
    ]
},
    "Wellness": {
        id: "wellness",
        name: "Wellness Rater",
        combinations: [
            {
                name: "Combination 1",
                formula: "(premium + minimum & maximum age)",
                description: "System displaying same premium for different age selection",
                quote: "https://prnt.sc/P_aSMsBnMQZ4",
                certificate: "https://prnt.sc/SXkhSDdwKCUM",
                status: "in-progress",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 2",
                formula: "(premium + occupation)",
                description: "Internal server error for occupation field",
                quote: "N/A",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 3",
                formula: "(premium + gender)",
                description: "System displaying same premium for different gender selection",
                quote: "https://prnt.sc/6BmAiTQAmcYY",
                certificate: "https://prnt.sc/SXkhSDdwKCUM",
                status: "in-progress",
                completionDate: getRandomDate()
            },
            {
                name: "Combination 4",
                formula: "(premium + smoker, minimum & maximum age)",
                description: "Internal server error for Smoker field",
                quote: "N/A",
                certificate: "N/A",
                status: "pending",
                completionDate: getRandomDate()
            }
        ]
    },
    "Marine": {
    id: "marine",
    name: "Marine Rater",
    combinations: [
        {
            name: "Combination 1",
            formula: "(premium + commodity type)",
            description: "System displaying premium calculation",
            rater: "https://prnt.sc/lXSHvat28MkL",
            quote: "https://prnt.sc/q2vfN3O9ieNo",
            certificate: "https://prnt.sc/7bSGdVb_BhXK",
            status: "completed",
            completionDate: getRandomDate()
        },
        {
            name: "Combination 2",
            formula: "(premium + voyage type)",
            description: "System displaying premium calculation",
            rater: "https://prnt.sc/qtudzB7zKF_f",
            quote: "https://prnt.sc/wK2N369YFW_W",
            certificate: "https://prnt.sc/K6rJs4pR7HGX",
            status: "completed",
            completionDate: getRandomDate()
        },
        {
            name: "Combination 3",
            formula: "(premium + conveyance type)",
            description: "System displaying premium calculation",
            rater: "https://prnt.sc/5BNhkX2veZiU",
            quote: "https://prnt.sc/A2A4QgbkzDSC",
            certificate: "https://prnt.sc/WxKMP23LCDWh",
            status: "completed",
            completionDate: getRandomDate()
        },
        {
            name: "Combination 4",
            formula: "(premium + package type)",
            description: "Error message displaying for commodity type field",
            rater: "https://prnt.sc/t0zblvdeX793",
            quote: "N/A",
            certificate: "N/A",
            status: "failed",
            completionDate: getRandomDate()
        },
        {
            name: "Combination 5",
            formula: "(premium + sum insured)",
            description: "System displaying premium calculation",
            rater: "https://prnt.sc/hV_ZcvwzoNmi",
            quote: "https://prnt.sc/qqlS49pEjTIt",
            certificate: "https://prnt.sc/TfX-oFo6NcQg",
            status: "completed",
            completionDate: getRandomDate()
        },
        {
            name: "Combination 6",
            formula: "(premium + transit type)",
            description: "Quote page not displaying",
            rater: "https://prnt.sc/C0zyKS7x4jt9",
            quote: "N/A",
            certificate: "N/A",
            status: "pending",
            completionDate: getRandomDate()
        }
    ]
}
};

// ---------------- DOM ELEMENTS ----------------
const segmentSelect = document.getElementById("segment");
const productSelect = document.getElementById("product");
const statusSegmentSelect = document.getElementById("status-segment");
const statusProductSelect = document.getElementById("status-product");
const descBox = document.getElementById("description-box");
const affinityContainer = document.getElementById("affinity-products");
const segmentContainer = document.getElementById("segment-cards");
const filterBtns = document.querySelectorAll('.filter-btn');
const filterSections = document.querySelectorAll('.filter-section');
const segmentView = document.getElementById("segment-view");
const productView = document.getElementById("product-view");
const raterView = document.getElementById("rater-view");
const backToSegmentsBtn = document.getElementById("back-to-segments-btn");
const raterSegmentName = document.getElementById("rater-segment-name");
const raterSubtitle = document.getElementById("rater-subtitle");
const raterContent = document.getElementById("rater-content");
const raterSearchInput = document.getElementById("rater-searchInput");
const raterStatusFilter = document.getElementById("rater-status-filter");
const raterSortBy = document.getElementById("rater-sort-by");
const raterSummaryStats = document.getElementById("rater-summary-stats");

// Stats elements
const totalSegmentsEl = document.getElementById("total-segments");
const workingSegmentsEl = document.getElementById("working-segments");
const notWorkingSegmentsEl = document.getElementById("not-working-segments");

const totalProductsEl = document.getElementById("total-products");
const workingProductsEl = document.getElementById("working-products");
const notWorkingProductsEl = document.getElementById("not-working-products");

// Current filter state
let currentFilterType = "segment";
let currentSegment = "";
let currentProduct = "";
let currentStatus = "ALL";

// Calculate and display stats
function updateStats() {
    // Product stats
    const total = data.length;
    const working = data.filter(item => item.Status === "YES").length;
    const notWorking = data.filter(item => item.Status === "NO").length;
    
    totalProductsEl.textContent = total;
    workingProductsEl.textContent = working;
    notWorkingProductsEl.textContent = notWorking;
    
    // Segment stats
    const segments = [...new Set(data.map(item => item.Segment))];
    const totalSegments = segments.length;
    
    // Calculate working segments (at least one product working)
    const workingSegments = segments.filter(segment => {
        const segmentProducts = data.filter(item => item.Segment === segment);
        return segmentProducts.some(product => product.Status === "YES");
    }).length;
    
    // Calculate not working segments (all products not working)
    const notWorkingSegments = segments.filter(segment => {
        const segmentProducts = data.filter(item => item.Segment === segment);
        return segmentProducts.every(product => product.Status === "NO");
    }).length;
    
    totalSegmentsEl.textContent = totalSegments;
    workingSegmentsEl.textContent = workingSegments;
    notWorkingSegmentsEl.textContent = notWorkingSegments;
}

// Populate segments
const segments = [...new Set(data.map(item=>item.Segment))];
segments.forEach(seg=>{
    let opt=document.createElement("option");
    opt.value=seg; opt.textContent=seg;
    segmentSelect.appendChild(opt);
});

// Populate products
const products = [...new Set(data.map(item=>item.Product))];
products.forEach(prod=>{
    let opt=document.createElement("option");
    opt.value=prod; opt.textContent=prod;
    productSelect.appendChild(opt);
});

// Render segment cards
function renderSegmentCards() {
    segmentContainer.innerHTML = "";
    
    const segments = [...new Set(data.map(item => item.Segment))];
    
    segments.forEach(segment => {
        const segmentData = data.filter(item => item.Segment === segment);
        const totalProducts = segmentData.length;
        const workingProducts = segmentData.filter(item => item.Status === "YES").length;
        const notWorkingProducts = segmentData.filter(item => item.Status === "NO").length;
        
        const segmentCard = document.createElement("div");
        segmentCard.className = "segment-card";
        segmentCard.innerHTML = `
            <h3>${segment}</h3>
            <div class="segment-stats">
                <div class="segment-stat">
                    <div class="segment-stat-value">${totalProducts}</div>
                    <div class="segment-stat-label">Total Products</div>
                </div>
                <div class="segment-stat">
                    <div class="segment-stat-value" style="color: #43a047;">${workingProducts}</div>
                    <div class="segment-stat-label">Working</div>
                </div>
                <div class="segment-stat">
                    <div class="segment-stat-value" style="color: #e53935;">${notWorkingProducts}</div>
                    <div class="segment-stat-label">Not Working</div>
                </div>
            </div>
        `;
        
        segmentCard.addEventListener("click", () => {
            showRaterForSegment(segment);
        });
        
        segmentContainer.appendChild(segmentCard);
    });
}

// Show rater for a specific segment
function showRaterForSegment(segment) {
    // Hide other views and show rater view
    segmentView.style.display = "none";
    productView.style.display = "none";
    raterView.style.display = "block";
    
    // Update header
    raterSegmentName.textContent = `${segment} Rater Combinations`;
    raterSubtitle.textContent = `Manage and view all rater combinations for ${segment}`;
    
    // Check if rater data exists for this segment
    if (raterData[segment]) {
        renderRaterContent(raterData[segment]);
    } else {
        showNoRaterMessage(segment);
    }
}

// Render rater content
function renderRaterContent(raterCategory) {
    // Calculate summary stats - treat "then-pending-now-completed" and "not-required" as completed
    const totalCombinations = raterCategory.combinations.length;
    
    // Count completed combinations (including "then-pending-now-completed" and "not-required")
    const completedCombinations = raterCategory.combinations.filter(c => 
        c.status === 'completed' || c.status === 'then-pending-now-completed' || c.status === 'not-required'
    ).length;
    
    // Count pending combinations (excluding "then-pending-now-completed" and "not-required")
    const pendingCombinations = raterCategory.combinations.filter(c => 
        c.status === 'pending' || c.status === 'in-progress' || 
        c.status === 'not-started' || c.status === 'failed'
    ).length;
    
    // Render summary stats - only 3 cards now
    raterSummaryStats.innerHTML = `
        <div class="rater-summary-stat">
            <div class="rater-summary-number">${totalCombinations}</div>
            <div class="rater-summary-label">Total</div>
        </div>
        <div class="rater-summary-stat">
            <div class="rater-summary-number" style="color: #27ae60;">${completedCombinations}</div>
            <div class="rater-summary-label">Completed</div>
        </div>
        <div class="rater-summary-stat">
            <div class="rater-summary-number" style="color: #e74c3c;">${pendingCombinations}</div>
            <div class="rater-summary-label">Pending</div>
        </div>
        <div class="rater-summary-stat" style="flex-grow: 1; min-width: 200px;">
            <div class="rater-summary-label">Completion Progress</div>
            <div class="progress-bar">
                <div class="progress-fill progress-completed" style="width: ${(completedCombinations / totalCombinations) * 100}%"></div>
            </div>
        </div>
    `;
    
    // Apply filters and sorting
    let filteredCombinations = [...raterCategory.combinations];
    
    // Status filter - treat "then-pending-now-completed" and "not-required" as completed for filtering
    const statusFilter = raterStatusFilter.value;
    if (statusFilter !== 'ALL') {
        if (statusFilter === 'completed') {
            filteredCombinations = filteredCombinations.filter(combo => 
                combo.status === 'completed' || combo.status === 'then-pending-now-completed' || combo.status === 'not-required'
            );
        } else if (statusFilter === 'not-required') {
            filteredCombinations = filteredCombinations.filter(combo => combo.status === 'not-required');
        } else {
            filteredCombinations = filteredCombinations.filter(combo => combo.status === statusFilter);
        }
    }
    
    // Search filter
    const searchTerm = raterSearchInput.value.toLowerCase();
    if (searchTerm) {
        filteredCombinations = filteredCombinations.filter(combo => 
            combo.name.toLowerCase().includes(searchTerm) || 
            combo.formula.toLowerCase().includes(searchTerm) ||
            combo.description.toLowerCase().includes(searchTerm)
        );
    }
    
    // Sort
    const sortBy = raterSortBy.value;
    if (sortBy === 'name') {
        filteredCombinations.sort((a, b) => a.name.localeCompare(b.name));
    } else if (sortBy === 'status') {
        filteredCombinations.sort((a, b) => a.status.localeCompare(b.status));
    } else if (sortBy === 'date') {
        filteredCombinations.sort((a, b) => new Date(a.completionDate) - new Date(b.completionDate));
    }
    
    // Render combinations
    raterContent.innerHTML = `
        <div class="rater-cards-container">
            <div class="rater-category-card">
                <div class="rater-card-header">
                    <h3>${raterCategory.name}</h3>
                    <span class="rater-combinations-count">${filteredCombinations.length} combinations</span>
                </div>
                <div class="rater-card-body">
                    ${filteredCombinations.length > 0 ? 
                        filteredCombinations.map(combo => `
                            <div class="rater-combination-item">
                                <div class="rater-combination-name">
                                    <span>${combo.name}</span>
                                    <span class="rater-status-badge rater-status-${combo.status}">${combo.status.replace(/-/g, ' ')}</span>
                                </div>
                                <div class="rater-combination-formula">${combo.formula}</div>
                                <div class="rater-combination-description">${combo.description}</div>
                                <div class="rater-links">
                                    ${combo.quote !== 'N/A' ? `<a href="${combo.quote}" target="_blank" class="rater-link"><i class="fas fa-external-link-alt"></i> Quote</a>` : '<span class="rater-link disabled">No Quote</span>'}
                                    ${combo.certificate !== 'N/A' ? `<a href="${combo.certificate}" target="_blank" class="rater-link"><i class="fas fa-file-certificate"></i> Certificate</a>` : '<span class="rater-link disabled">No Certificate</span>'}
                                    ${combo.rater ? `<a href="${combo.rater}" target="_blank" class="rater-link"><i class="fas fa-calculator"></i> Rater</a>` : ''}
                                </div>
                                <div class="rater-completion-date">Expected: ${formatDate(combo.completionDate)}</div>
                            </div>
                        `).join('') : 
                        '<div class="no-results">No combinations match your filters</div>'
                    }
                </div>
            </div>
        </div>
    `;
}

// Show message when no rater is available
function showNoRaterMessage(segment) {
    raterContent.innerHTML = `
        <div class="no-rater-message">
            <i class="fas fa-tools"></i>
            <h3>Rater Under Development</h3>
            <p>We're currently working on the rater functionality for ${segment}.</p>
            <p>Please check back later for updates.</p>
        </div>
    `;
}

// Format date function
function formatDate(dateString) {
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    return new Date(dateString).toLocaleDateString('en-US', options);
}

// Render product cards based on current filter
function renderProductCards(){
    affinityContainer.innerHTML="";
    
    let filteredData = [...data];
    
    // Apply filters based on current filter type
    if (currentFilterType === "segment") {
        if (currentSegment) {
            filteredData = filteredData.filter(item => item.Segment === currentSegment);
        }
        if (currentStatus !== "ALL") {
            filteredData = filteredData.filter(item => item.Status === currentStatus);
        }
    } else if (currentFilterType === "product") {
        if (currentProduct) {
            filteredData = filteredData.filter(item => item.Product === currentProduct);
        }
        if (currentStatus !== "ALL") {
            filteredData = filteredData.filter(item => item.Status === currentStatus);
        }
        // Also apply segment filter if a segment is selected
        if (currentSegment) {
            filteredData = filteredData.filter(item => item.Segment === currentSegment);
        }
    }
    
    // Render the filtered products
    filteredData.forEach(item=>{
        let card=document.createElement("div");
        card.className="product-card";
        if(item.Affinity) card.classList.add("affinity");
        card.innerHTML=`<h3>${item.Product}</h3><p>Segment: ${item.Segment}</p><p>Status: <span class="status ${item.Status}">${item.Status}</span></p>`;
        card.addEventListener("click",()=>{showModal(item)});
        affinityContainer.appendChild(card);
    });
    
    // Update description box if a product is selected
    if (currentFilterType === "product" && currentProduct) {
        const prod = data.find(item => item.Product === currentProduct);
        if (prod) {
            descBox.innerHTML=`<h4>${prod.Product}</h4><p>${prod.Description}</p><div>Status: <span class="status ${prod.Status}">${prod.Status}</span></div>`;
        }
    } else if (currentSegment) {
        descBox.innerHTML=`<h4>${currentSegment}</h4><p>Showing ${filteredData.length} product(s) in this segment</p>`;
    } else {
        descBox.innerHTML="Select a product or segment to see details.";
    }
}

// Initial render and stats
renderSegmentCards();
updateStats();

// Back to segments button
backToSegmentsBtn.addEventListener("click", () => {
    raterView.style.display = "none";
    segmentView.style.display = "block";
    productView.style.display = "none";
    currentFilterType = "segment";
    
    // Reset filter buttons
    filterBtns.forEach(btn => btn.classList.remove('active'));
    document.querySelector('[data-filter="segment"]').classList.add('active');
    
    // Reset filter sections
    filterSections.forEach(section => section.classList.remove('active'));
    document.getElementById('segment-filter').classList.add('active');
});

// Filter toggle functionality
filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
        // Update active button
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Update active filter section
        const filterType = btn.getAttribute('data-filter');
        filterSections.forEach(section => {
            section.classList.remove('active');
            if (section.id === `${filterType}-filter`) {
                section.classList.add('active');
            }
        });
        
        // Update current filter type and reset selections
        currentFilterType = filterType;
        currentSegment = "";
        currentProduct = "";
        currentStatus = "ALL";
        
        // Reset dropdowns
        segmentSelect.value = "";
        productSelect.value = "";
        statusSegmentSelect.value = "ALL";
        statusProductSelect.value = "ALL";
        
        // Show/hide appropriate views
        if (filterType === "segment") {
            segmentView.style.display = "block";
            productView.style.display = "none";
            raterView.style.display = "none";
            descBox.innerHTML = "Select a segment to see its products or rater details.";
        } else {
            segmentView.style.display = "none";
            productView.style.display = "block";
            raterView.style.display = "none";
            renderProductCards();
        }
    });
});

// Segment filter
segmentSelect.addEventListener("change",()=>{
    currentSegment = segmentSelect.value;
    if (currentFilterType === "segment") {
        // If in segment view, switch to product view when segment is selected
        currentFilterType = "product";
        segmentView.style.display = "none";
        productView.style.display = "block";
        raterView.style.display = "none";
        filterBtns.forEach(btn => btn.classList.remove('active'));
        document.querySelector('[data-filter="product"]').classList.add('active');
        filterSections.forEach(section => section.classList.remove('active'));
        document.getElementById('product-filter').classList.add('active');
    }
    renderProductCards();
});

// Product filter
productSelect.addEventListener("change",()=>{
    currentProduct = productSelect.value;
    renderProductCards();
});

// Status filter for segment section
statusSegmentSelect.addEventListener("change",()=>{
    currentStatus = statusSegmentSelect.value;
    if (currentFilterType === "segment") {
        renderSegmentCards();
    } else {
        renderProductCards();
    }
});

// Status filter for product section
statusProductSelect.addEventListener("change",()=>{
    currentStatus = statusProductSelect.value;
    renderProductCards();
});

// Rater search functionality
raterSearchInput.addEventListener("input", () => {
    const currentSegmentName = raterSegmentName.textContent.replace(' Rater Combinations', '');
    if (raterData[currentSegmentName]) {
        renderRaterContent(raterData[currentSegmentName]);
    }
});

// Rater status filter
raterStatusFilter.addEventListener("change", () => {
    const currentSegmentName = raterSegmentName.textContent.replace(' Rater Combinations', '');
    if (raterData[currentSegmentName]) {
        renderRaterContent(raterData[currentSegmentName]);
    }
});

// Rater sort by
raterSortBy.addEventListener("change", () => {
    const currentSegmentName = raterSegmentName.textContent.replace(' Rater Combinations', '');
    if (raterData[currentSegmentName]) {
        renderRaterContent(raterData[currentSegmentName]);
    }
});

// Modal logic
const modal=document.getElementById("modal");
const modalBody=document.getElementById("modal-body");
const closeBtn=document.getElementById("close-btn");
function showModal(item){
    modalBody.innerHTML=`<h2>${item.Product}</h2><p>Segment: ${item.Segment}</p><p>${item.Description}</p><p>Status: <span class="status ${item.Status}">${item.Status}</span></p>`;
    modal.style.display="flex";
}
closeBtn.addEventListener("click",()=>{modal.style.display="none";});
window.addEventListener("click",e=>{if(e.target==modal) modal.style.display="none";});
</script>
</body>
</html>